<!DOCTYPE html>
<html lang="no">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
<title>Gjenstående Tapping</title>

<style>
body {
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  background: #f7f7f7;
  margin: 0;
  padding: 16px;
}

.container {
  max-width: 420px;
  margin: auto;
  background: #fff;
  padding: 16px;
  border-radius: 14px;
  box-shadow: 0 10px 25px rgba(0,0,0,0.08);
}

h1 {
  text-align: center;
  margin-bottom: 16px;
}

label {
  font-weight: 600;
  margin-top: 12px;
  display: block;
}

input {
  width: 100%;
  padding: 14px;
  font-size: 18px;
  margin-top: 6px;
  border-radius: 10px;
  border: 1px solid #ccc;
}

button {
  margin-top: 12px;
  padding: 14px;
  width: 100%;
  font-size: 18px;
  border-radius: 12px;
  border: none;
  cursor: pointer;
}

.add {
  background: #e0e0e0;
}

.reset {
  background: #e53935;
  color: #fff;
}

.tanks {
  margin-top: 20px;
}

.tank {
  margin-top: 14px;
}

.tank-bar {
  height: 120px;
  background: #eee;
  border-radius: 12px;
  overflow: hidden;
}

.fill {
  background: linear-gradient(180deg, #4fc3f7, #0288d1);
  height: 100%;
  transform-origin: bottom;
  transform: scaleY(1);
}

.remove {
  background: #bbb;
  margin-top: 6px;
}

.result {
  font-size: 26px;
  font-weight: bold;
  text-align: center;
  margin: 20px 0;
}
</style>
</head>

<body>
<div class="container">
<h1>Gjenstående Tapping</h1>

<label>Steriltank (liter)</label>
<input id="steril" inputmode="numeric" pattern="[0-9]*">

<button class="add" onclick="addTank()">+ Legg til Modningstank</button>

<div id="modning-inputs"></div>

<label>Liter per time (per maskin)</label>
<input id="lph" inputmode="numeric" pattern="[0-9]*">

<label>Antall maskiner</label>
<input id="machines" inputmode="numeric" pattern="[0-9]*">

<div class="result" id="time"></div>

<div class="tanks" id="visuals"></div>

<button class="reset" onclick="resetAll()">Nullstill</button>
</div>

<script>
let modning = [];
let animId;

function addTank() {
  modning.push({ liters: 0, current: 0 });

  renderInputs();
  renderVisuals();

  setTimeout(() => {
    const inputs = document.querySelectorAll('.modning-input');
    inputs[inputs.length - 1].focus();
    inputs[inputs.length - 1].scrollIntoView({ behavior: 'smooth', block: 'center' });
  }, 50);
}

function renderInputs() {
  const box = document.getElementById('modning-inputs');
  box.innerHTML = '';
  modning.forEach((t, i) => {
    box.innerHTML += `
      <label>Modningstank ${i + 1} (liter)</label>
      <input class="modning-input" inputmode="numeric" pattern="[0-9]*"
        oninput="modning[${i}].liters=this.value; modning[${i}].current=this.value">
      <button class="remove" onclick="removeTank(${i})">− Fjern</button>
    `;
  });
}

function removeTank(i) {
  modning.splice(i, 1);
  renderInputs();
  renderVisuals();
}

function renderVisuals() {
  const v = document.getElementById('visuals');
  v.innerHTML = '';

  modning.forEach(() => {
    v.innerHTML += `
      <div class="tank">
        <div class="tank-bar"><div class="fill"></div></div>
      </div>
    `;
  });

  v.innerHTML += `
    <div class="tank">
      <div class="tank-bar"><div class="fill"></div></div>
    </div>
  `;
}

function resetAll() {
  cancelAnimationFrame(animId);
  modning = [];
  document.querySelectorAll('input').forEach(i => i.value = '');
  document.getElementById('modning-inputs').innerHTML = '';
  document.getElementById('visuals').innerHTML = '';
  document.getElementById('time').textContent = '';
  localStorage.clear();
}

function loop() {
  const rate = (Number(lph.value) || 0) * (Number(machines.value) || 0);
  if (!rate) return animId = requestAnimationFrame(loop);

  let sterile = Number(steril.value) || 0;
  let remaining = sterile;

  modning.forEach(t => remaining += Number(t.current));

  const hours = remaining / rate;
  document.getElementById('time').textContent =
    hours > 0 ? `ca. ${Math.ceil(hours)} timer` : '';

  const fills = document.querySelectorAll('.fill');
  modning.forEach((t, i) => {
    t.current = Math.max(0, t.current - rate / 3600);
    fills[i].style.transform = `scaleY(${t.current / t.liters || 0})`;
  });

  fills[fills.length - 1].style.transform =
    `scaleY(${sterile / (steril.value || 1)})`;

  animId = requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>
