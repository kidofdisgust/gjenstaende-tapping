<!DOCTYPE html>
<html lang="no">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gjenstående Tapping</title>

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="Gjenstående Tapping">

<style>
* { box-sizing: border-box; }

body {
  font-family: system-ui, sans-serif;
  background: #f2f2f2;
  display: flex;
  justify-content: center;
  padding: 1rem;
}

.box {
  background: white;
  padding: 1.2rem;
  border-radius: 14px;
  width: 100%;
  max-width: 360px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

h2 {
  text-align: center;
  margin-top: 0;
}

label {
  display: block;
  margin-top: 1.1rem;
  font-weight: 600;
  font-size: 1.1rem;
}

input {
  width: 100%;
  padding: 0.9rem;
  font-size: 1.6rem;
  margin-top: 0.4rem;
}

input[type=number]::-webkit-inner-spin-button,
input[type=number]::-webkit-outer-spin-button {
  -webkit-appearance: none;
}
input[type=number] { -moz-appearance: textfield; }

.modning-block {
  margin-top: 1.1rem;
}

.modning-row {
  display: flex;
  gap: 0.4rem;
  align-items: center;
  margin-top: 0.4rem;
}

.modning-row input {
  flex: 1;
}

.remove-btn {
  width: 48px;
  font-size: 1.6rem;
  background: #ddd;
  border: none;
  border-radius: 8px;
}

.add-btn {
  width: 100%;
  margin-top: 1.1rem;
  padding: 0.7rem;
  font-size: 1.4rem;
  border: none;
  border-radius: 10px;
  background: #e0e0e0;
}

.result {
  margin-top: 1.2rem;
  padding: 1rem;
  background: #eef6ff;
  border-radius: 10px;
  font-size: 1.6rem;
  text-align: center;
  font-weight: 700;
}

.total {
  background: #f7f7f7;
  font-size: 1.4rem;
}

button.reset {
  width: 100%;
  margin-top: 1.2rem;
  padding: 0.8rem;
  font-size: 1.2rem;
  border: none;
  border-radius: 10px;
  background: #d9534f;
  color: white;
  font-weight: 600;
}
</style>
</head>

<body>

<div class="box">
  <h2>Gjenstående Tapping</h2>

  <label>Steriltank (liter)</label>
  <input id="steriltank" type="number" inputmode="numeric">

  <button class="add-btn" id="addTank">+ Legg til Modningstank</button>

  <div id="modningContainer"></div>

  <label>Liter per Time (per maskin)</label>
  <input id="rate" type="number" inputmode="numeric">

  <label>Antall Tappemaskiner</label>
  <input id="machines" type="number" inputmode="numeric">

  <div id="totalLiters" class="result total">0 L</div>
  <div id="timeResult" class="result">ca. Timer</div>

  <button class="reset" id="resetBtn">Nullstill</button>
</div>

<script>
const MAX_MODNING = 5;
const modningContainer = document.getElementById("modningContainer");

function calculate() {
  let total = Number(steriltank.value) || 0;

  document.querySelectorAll(".modning-input").forEach(i => {
    total += Number(i.value) || 0;
  });

  totalLiters.textContent = `${total.toLocaleString()} L`;

  const rateVal = Number(rate.value) || 0;
  const machinesVal = Number(machines.value) || 0;
  const capacity = rateVal * machinesVal;

  if (capacity > 0 && total > 0) {
    timeResult.textContent = `ca. ${Math.ceil(total / capacity)} Timer`;
  } else {
    timeResult.textContent = "ca. Timer";
  }

  localStorage.setItem("state", JSON.stringify({
    steriltank: steriltank.value,
    modning: [...document.querySelectorAll(".modning-input")].map(i => i.value),
    rate: rate.value,
    machines: machines.value
  }));
}

function addModningTank(value = "") {
  if (document.querySelectorAll(".modning-block").length >= MAX_MODNING) return;

  const block = document.createElement("div");
  block.className = "modning-block";

  block.innerHTML = `
    <label>Modningstank (liter)</label>
    <div class="modning-row">
      <input class="modning-input" type="number" inputmode="numeric">
      <button class="remove-btn">−</button>
    </div>
  `;

  const input = block.querySelector("input");
  input.value = value;
  input.addEventListener("input", calculate);
  input.addEventListener("focus", e =>
    e.target.scrollIntoView({ behavior:"smooth", block:"center" })
  );

  block.querySelector("button").onclick = () => {
    block.remove();
    calculate();
  };

  modningContainer.appendChild(block);
  setTimeout(() => input.focus(), 50);
}

addTank.onclick = () => addModningTank();

resetBtn.onclick = () => {
  localStorage.removeItem("state");
  steriltank.value = "";
  rate.value = "";
  machines.value = "";
  modningContainer.innerHTML = "";
  totalLiters.textContent = "0 L";
  timeResult.textContent = "ca. Timer";
};

[steriltank, rate, machines].forEach(i => {
  i.addEventListener("input", calculate);
  i.addEventListener("focus", e =>
    e.target.scrollIntoView({ behavior:"smooth", block:"center" })
  );
});

window.addEventListener("DOMContentLoaded", () => {
  const saved = JSON.parse(localStorage.getItem("state") || "{}");
  if (saved.steriltank) steriltank.value = saved.steriltank;
  if (saved.rate) rate.value = saved.rate;
  if (saved.machines) machines.value = saved.machines;
  (saved.modning || []).forEach(v => addModningTank(v));
  calculate();
});
</script>

</body>
</html>
